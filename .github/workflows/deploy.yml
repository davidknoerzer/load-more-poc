name: Deploy Angular to GitHub Pages

on:
    push:
        branches:
            - main # Trigger deployment on pushes to main branch
    workflow_dispatch: # Allow manual trigger

permissions:
    contents: read
    pages: write
    id-token: write

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            # 1️⃣ Checkout repository
            - name: Checkout code
              uses: actions/checkout@v4

            # 2️⃣ Set up Node.js
            - name: Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: "20"

            # 3️⃣ Install dependencies
            - name: Install dependencies
              run: npm ci

            # 4️⃣ Build Angular app
            - name: Build Angular app
              run: ng build --configuration=production

            # 5️⃣ Copy _redirects for SPA routing
            - name: Add SPA fallback for GitHub Pages
              run: cp src/_redirects dist/show-more-poc-routing/

            # 6️⃣ Upload build artifact
            - name: Upload Pages artifact
              uses: actions/upload-pages-artifact@v3
              with:
                  path: dist/show-more-poc-routing

    deploy:
        needs: build
        runs-on: ubuntu-latest
        steps:
            # 7️⃣ Deploy to GitHub Pages
            - name: Deploy to GitHub Pages
              uses: actions/deploy-pages@v4
